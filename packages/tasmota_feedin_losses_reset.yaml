###############################################################################
#  SERVICE-SKRIPT: Feed-in Loss zur√ºcksetzen (mit Best√§tigung, modernisiert)
###############################################################################
script:
  solar_feedin_loss_reset:
    alias: "Einspeise-Verluste zur√ºcksetzen"
    icon: mdi:restore
    mode: single

    fields:
      confirm:
        name: "Best√§tigung erforderlich"
        description: "Muss 'ja', 'yes' oder 'y' sein, um wirklich zur√ºckzusetzen."
        example: "ja"
        required: false
        default: ""

    sequence:
      - choose:
          #######################################################################
          # Wenn Benutzer wirklich best√§tigt (ja/yes/y) ‚Üí Reset durchf√ºhren
          #######################################################################
          - conditions:
              - condition: template
                value_template: "{{ confirm | lower in ['ja','yes','y'] }}"
            sequence:
              - service: input_number.set_value
                target:
                  entity_id: input_number.saving_feedin_loss
                data:
                  value: 0

              - service: logbook.log
                data:
                  name: "Solar Feed-in Loss Reset"
                  message: "üîÑ Einspeise-Verlust-Summe wurde auf 0 ‚Ç¨ zur√ºckgesetzt."

              - choose:
                  - conditions: "{{ is_state('input_boolean.solar_feedin_debug','on') }}"
                    sequence:
                      - service: system_log.write
                        data:
                          level: warning
                          message: "[Solar Feed-in Loss] Verlust-Summe manuell auf 0 ‚Ç¨ gesetzt (per Skript)."

        #########################################################################
        # Standardpfad: Keine oder falsche Best√§tigung ‚Üí Abbruchmeldung
        #########################################################################
        default:
          - service: logbook.log
            data:
              name: "Solar Feed-in Loss Reset"
              message: "‚ùå R√ºcksetzen abgebrochen (keine g√ºltige Best√§tigung)."
