###############################################################################
#  SERVICE-SKRIPT: Solar-Ersparnisse zur√ºcksetzen (mit Best√§tigung, Fix)
###############################################################################
script:
  solar_savings_reset:
    alias: "Solar-Ersparnisse zur√ºcksetzen"
    icon: mdi:restore
    mode: single
    
    fields:
      confirm:
        name: Best√§tigung erforderlich
        description: "Muss 'ja' oder 'yes' sein, um wirklich zu l√∂schen."
        example: "ja"
        required: false
        default: ""
    sequence:
      - choose:
          - conditions:
              - condition: template
                value_template: >
                  {{ confirm | lower in ['ja','yes','y'] }}
            sequence:
              - service: input_number.set_value
                target:
                  entity_id:
                    - input_number.saving_pv_total
                    - input_number.saving_battery
                    - input_number.saving_pv_passthrough
                data:
                  value: 0
              - service: logbook.log
                data:
                  name: "Solar Savings Reset"
                  message: "üîÑ Alle Ersparnisz√§hler wurden auf 0 ‚Ç¨ zur√ºckgesetzt."
              - choose:
                  - conditions: "{{ is_state('input_boolean.solar_savings_debug','on') }}"
                    sequence:
                      - service: system_log.write
                        data:
                          level: warning
                          message: "[Solar Savings] Alle Ersparnisz√§hler auf 0 ‚Ç¨ gesetzt (per Skript)."
        default:
          - service: logbook.log
            data:
              name: "Solar Savings Reset"
              message: "‚ùå R√ºcksetzen abgebrochen (keine Best√§tigung)."
